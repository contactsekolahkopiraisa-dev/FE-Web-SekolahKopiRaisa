{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\n\r\nexport function middleware(request: NextRequest) {\r\n  console.log('All cookies:', request.cookies.getAll());\r\n  const token = request.cookies.get('token')?.value;\r\n  console.log('Token found:', !!token);\r\n  console.log('Token value (first 50 chars):', token?.substring(0, 50));\r\n  \r\n  const isAdminRoute = request.nextUrl.pathname.startsWith('/admin');\r\n  const isLayananRoute = request.nextUrl.pathname.startsWith('/layanan');\r\n\r\n  // If no token, block protected routes (/admin and /layanan) and redirect to login\r\n  if (!token) {\r\n    if (isAdminRoute || isLayananRoute) {\r\n      console.log('No token found, redirecting to login for protected route');\r\n      return NextResponse.redirect(new URL('/login', request.url));\r\n    }\r\n    console.log('No token found, allowing public access');\r\n    return NextResponse.next();\r\n  }\r\n\r\n  try {\r\n    // Decode JWT token payload\r\n    const payload = JSON.parse(atob(token.split('.')[1]));\r\n    console.log('Decoded payload:', payload);\r\n    \r\n    const isAdmin = payload.admin;\r\n    \r\n    // If user is admin\r\n    if (isAdmin) {\r\n      console.log('User is admin');\r\n      \r\n      // Admin can access /admin routes and /assets routes\r\n      if (!isAdminRoute && !request.nextUrl.pathname.startsWith('/assets')) {\r\n        console.log('Admin trying to access non-admin route, redirecting to admin dashboard');\r\n        return NextResponse.redirect(new URL('/admin', request.url));\r\n      }\r\n      \r\n      console.log('Admin accessing admin route or assets, allowing access');\r\n      return NextResponse.next();\r\n    }\r\n    \r\n    // If user is not admin\r\n    if (!isAdmin) {\r\n      console.log('User is not admin');\r\n      \r\n      // Non-admin cannot access /admin routes\r\n      if (isAdminRoute) {\r\n        console.log('Non-admin trying to access admin route, redirecting to unauthorized');\r\n        return NextResponse.redirect(new URL('/unauthorized', request.url));\r\n      }\r\n      \r\n      console.log('Non-admin accessing public route or /layanan, allowing access');\r\n      return NextResponse.next();\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.log('Error decoding token:', error);\r\n    // If token is invalid, redirect to login\r\n    return NextResponse.redirect(new URL('/login', request.url));\r\n  }\r\n  \r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    '/((?!api|_next/static|_next/image|favicon.ico|login|unauthorized).*)',\r\n  ]\r\n};\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAGO,SAAS,WAAW,OAAoB;IAC7C,QAAQ,GAAG,CAAC,gBAAgB,QAAQ,OAAO,CAAC,MAAM;IAClD,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;IAC5C,QAAQ,GAAG,CAAC,gBAAgB,CAAC,CAAC;IAC9B,QAAQ,GAAG,CAAC,iCAAiC,OAAO,UAAU,GAAG;IAEjE,MAAM,eAAe,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IACzD,MAAM,iBAAiB,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAE3D,kFAAkF;IAClF,IAAI,CAAC,OAAO;QACV,IAAI,gBAAgB,gBAAgB;YAClC,QAAQ,GAAG,CAAC;YACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;QACA,QAAQ,GAAG,CAAC;QACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B;IAEA,IAAI;QACF,2BAA2B;QAC3B,MAAM,UAAU,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;QACnD,QAAQ,GAAG,CAAC,oBAAoB;QAEhC,MAAM,UAAU,QAAQ,KAAK;QAE7B,mBAAmB;QACnB,IAAI,SAAS;YACX,QAAQ,GAAG,CAAC;YAEZ,oDAAoD;YACpD,IAAI,CAAC,gBAAgB,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,YAAY;gBACpE,QAAQ,GAAG,CAAC;gBACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;YAC5D;YAEA,QAAQ,GAAG,CAAC;YACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;QAC1B;QAEA,uBAAuB;QACvB,IAAI,CAAC,SAAS;YACZ,QAAQ,GAAG,CAAC;YAEZ,wCAAwC;YACxC,IAAI,cAAc;gBAChB,QAAQ,GAAG,CAAC;gBACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iBAAiB,QAAQ,GAAG;YACnE;YAEA,QAAQ,GAAG,CAAC;YACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;QAC1B;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,GAAG,CAAC,yBAAyB;QACrC,yCAAyC;QACzC,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}